Komentar na delovanje
Merilna naprava razdalje uporablja ultrazvočni senzor HC-SR04, povezan z Arduino Uno R3, in LCD zaslon za izpis razdalje v centimetrih. Naprava deluje po naslednjem principu:
Delovanje: HC-SR04 pošlje ultrazvočni impulz prek pin-a triggerPin (pin 7). Čas povratka odboja se izmeri na pin-u echoPin (pin 6) z uporabo funkcije pulseIn(). Razdalja se izračuna z uporabo hitrosti zvoka (343 m/s pri 20 °C) po formuli: razdalja = čas * 0.034 / 2 (v centimetrih). Rezultat se prikaže na LCD zaslonu (16x2 znaki) z osveževanjem vsakih 100 ms.
Prednosti:
Enostavna implementacija s standardnimi komponentami (HC-SR04, Arduino Uno R3, LCD zaslon).
3D-tiskano ohišje omogoča prenosnost in zaščito komponent.
Podpora za baterijsko ali USB napajanje povečuje prilagodljivost uporabe.
LCD zaslon zagotavlja neposreden in jasen prikaz razdalje brez potrebe po zunanji napravi.
Naprava je primerna za izobraževalne namene, prototipe ali preproste aplikacije, kot je merjenje razdalje do ovir.
Omejitve:
Koda ne vključuje temperaturne kompenzacije, kar vpliva na natančnost pri spremembah temperature (hitrost zvoka se spreminja za ~0,6 m/s na °C).
Osveževanje zaslona vsakih 100 ms lahko povzroči utripanje (flickering) zaradi pogostega klicanja lcd.clear().
Ni povprečenja meritev ali filtriranja, kar lahko vodi do nestabilnih rezultatov ob motnjah (npr. šum, večkratni odboji).
HC-SR04 ima omejitve pri merjenju razdalj do mehkih ali nepravilnih površin in pri razdaljah manj kot 2 cm ali več kot 4 m.
Na splošno naprava deluje zanesljivo za osnovne aplikacije, kot so merjenje razdalj v zaprtih prostorih ali v izobraževalnih projektih. 






Ocena natančnosti delovanja
Primerjane vrednosti, izmerjene z napravo (HC-SR04 senzorjem), z referenčnimi vrednostmi, izmerjenimi z merilnim trakom "Mater 3 m" (natančnost ±1 mm). Umerjanje je bilo izvedeno 16.6.2025 pri temperaturi 27,1 °C in največji razdalji 200 cm.
Specifikacije HC-SR04:
Merilni razpon: 2 cm do 400 cm.
Natančnost: ±3 mm (pod idealnimi pogoji).
Ločljivost: ~0,3 cm (odvisno od časovne ločljivosti pulseIn()).
Analiza meritev:
Tabela prikazuje 10 meritev z referenčnimi razdaljami (XP​) od 10 cm do 200 cm in izmerjenimi vrednostmi (XI​).
Izračunana absolutna napaka (MX) in relativna napaka (mX) kažejo naslednje:
Največja absolutna napaka: 5 cm (pri 10 cm in 200 cm).
Največja relativna napaka: 25 % (pri 10 cm).
Povprečna absolutna napaka: ~3,3 cm (povprečje MX​ čez vse meritve).
Povprečna relativna napaka: ~8,5 % (povprečje mX​ čez vse meritve).
Napake so večje pri krajših razdaljah (npr. 25 % pri 10 cm) in se zmanjšajo pri daljših razdaljah (npr. 2 % pri 180 cm in 200 cm), kar nakazuje sistematično odstopanje, morda zaradi omejenega merilnega območja HC-SR04 (< 2 cm) ali vpliva temperature.
Primerjava z referenčnim inštrumentom:
Referenčni merilni trak "Mater 3 m" ima natančnost ±1 mm, medtem ko HC-SR04 kaže odstopanja do 5 cm, kar je bistveno slabše.
Pri razdaljah do 50 cm so relativne napake med 10 % in 25 %, kar presega specifikacijo ±3 mm HC-SR04, kar kaže na vpliv okoljskih dejavnikov (npr. temperatura 27,1 °C) ali neustrezno kalibracijo.
Pri razdaljah nad 100 cm se napaka zmanjša na 2–6 %, kar je bolj v skladu z pričakovano natančnostjo senzorja, a še vedno presega referenčno natančnost (±1 mm).
Vpliv okolja:
Temperatura 27,1 °C (višja od standardnih 20 °C) poveča hitrost zvoka (~345 m/s), kar bi moralo zmanjšati izmerjene razdalje za ~1,2 % (npr. 1,2 mm na 100 cm), vendar so meritve pogosto previsoke (npr. 27 cm pri 30 cm).
Širok ultrazvočni stožec (~15°) lahko povzroči motnje pri majhnih razdaljah ali nepravilnih površinah, kar poveča napako.
Zaključek o natančnosti:
Naprava dosega natančnost z absolutno napako do 5 cm in relativno napako do 25 %, kar je slabše od specifikacije HC-SR04 (±3 mm) in referenčnega merilnega traka (±1 mm).
Največja natančnost (~2 %) je dosežena pri razdaljah 180–200 cm, medtem ko so meritve pri razdaljah pod 50 cm nezanesljive (napaka > 10 %).
Brez temperaturne kompenzacije in kalibracije je natančnost omejena, zlasti pri kratkih razdaljah, kjer je HC-SR04 manj zanesljiv.

Predlagane izboljšave
Temperaturna kompenzacija:
Dodatek temperaturnega senzorja za prilagoditev hitrosti zvoka:
Spremba formule za razdaljo:
#include <OneWire.h>
#include <DallasTemperature.h>
#define ONE_WIRE_BUS 8 // Pin za temperaturni senzor
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensors(&oneWire);

void setup() {
  sensors.begin();
  // Ostala inicializacija
}

void loop() {
  sensors.requestTemperatures();
  float temperature = sensors.getTempCByIndex(0);
  float speedOfSound = 331.4 + 0.6 * temperature;
  long duration, distance;
  digitalWrite(triggerPin, LOW);
  delayMicroseconds(2);
  digitalWrite(triggerPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(triggerPin, LOW);
  duration = pulseIn(echoPin, HIGH);
  distance = (duration * speedOfSound) / 20000.0; // Razdalja v cm
  lcd.clear();
  lcd.print("Dist: ");
  lcd.print(distance);
  lcd.print(" cm");
  delay(100);
  }


Povprečenje meritev:
Implementirajte povprečenje 5–10 meritev za zmanjšanje šuma in povečanje stabilnosti.
Primer kode:
 float measureDistance() {
  float sum = 0;
  int samples = 5;
  for (int i = 0; i < samples; i++) {
    digitalWrite(triggerPin, LOW);
    delayMicroseconds(2);
    digitalWrite(triggerPin, HIGH);
    delayMicroseconds(10);
    digitalWrite(triggerPin, LOW);
    long duration = pulseIn(echoPin, HIGH);
    sum += (duration * 0.034) / 2;
    delay(50); // Počakaj med meritvami
  }
  return sum / samples;
}

void loop() {
  float distance = measureDistance();
  lcd.clear();
  lcd.print("Distance: ");
  lcd.print(distance);
  lcd.print(" cm");
  delay(100);
}


Optimizacija LCD izpisa:
Odstranitev lcd.clear() in namesto tega posodablja samo spremenjene dele zaslona, da preprečite utripanje.
Primer:
 void loop() {
  float distance = measureDistance();
  lcd.setCursor(0, 0);
  lcd.print("Distance: ");
  lcd.print(distance);
  lcd.print(" cm  "); // Dodani presledki za brisanje starih znakov
  delay(100);
}


Filtriranje motenj:
Dodajanje median filtra za odstranjevanje izstopajočih vrednosti. Uporaba knjižnice, kot je RunningMedian, ali ročna implementacija.
Primer:
 float measureDistance() {
  float measurements[5];
  for (int i = 0; i < 5; i++) {
    digitalWrite(triggerPin, LOW);
    delayMicroseconds(2);
    digitalWrite(triggerPin, HIGH);
    delayMicroseconds(10);
    digitalWrite(triggerPin, LOW);
    long duration = pulseIn(echoPin, HIGH);
    measurements[i] = (duration * 0.034) / 2;
    delay(50);
  }
  // Razvrsti meritve in vrni mediano
  for (int i = 0; i < 5; i++) {
    for (int j = i + 1; j < 5; j++) {
      if (measurements[i] > measurements[j]) {
        float temp = measurements[i];
        measurements[i] = measurements[j];
        measurements[j] = temp;
      }
    }
  }
  return measurements[2]; // Mediana
}


Kalibracijski način:
Dodajanje možnost vnosa referenčne razdalje prek serijskega vmesnika ali gumba za izračun korekcijskega faktorja (glej postopek kalibracije spodaj).
Izboljšanje strojne opreme:
Dodajanje mehanskega omejevalnika (npr. plastično cev) okoli HC-SR04 za zožitev ultrazvočnega stožca in izboljšanje natančnosti pri majhnih ovirah.

Alternativni senzorji:
Za večjo natančnost bi lahko uporabili laserski senzor, kot je VL53L0X (natančnost ±3 mm do 2 m, manj občutljiv na okoljske dejavnike).
Dodatne funkcije:
Dodajanje Bluetooth modula (npr. HC-05) za prenos meritev na pametni telefon.
Vklop prikaza temperature na LCD zaslonu, če dodamo temperaturni senzor.

Postopek kalibracije senzorja
Kalibracija je potrebna za zmanjšanje sistematičnih napak, ki izhajajo iz okoljskih dejavnikov ali netočnosti senzorja. Uporabljen je bil merilni trak. Spodaj je postopek kalibracije:
Priprava:
Postavite napravo na stabilno površino v zaprtem prostoru brez zračnih tokov ali motenj.
Uporabite referenčni merilni trak (natančnost ±1 mm) za merjenje znanih razdalj.
Izmerite temperaturo okolja (npr. z zunanjim termometrom, če temperaturni senzor ni na voljo).
Meritve:
Postavite senzor na fiksne razdalje od trdne, ravne površine (npr. 50 cm, 100 cm, 200 cm).
Hkrati izmerite enake razdalje z merilnim trakom in beležite referenčne vrednosti.

Primer tabele za beleženje:
Referenčna razdalja (cm)
Izmerjena razdalja (cm)
Odstopanje (cm)
50
49.5
-0.5
100
101.2
+1.2
200
198.7
-1.3


Programska implementacija:
Kalibracijski način v kodi, kjer uporabnik vnese referenčno razdaljo prek serijskega vmesnika:
 


float calibrationFactor = 1.0; // Privzeti faktor

void setup() {
  Serial.begin(9600);
  // Ostala inicializacija
}

void calibrate() {
  Serial.println("Vnesite referenčno razdaljo v cm:");
  while (!Serial.available()) {}
  float referenceDistance = Serial.parseFloat();
  float measuredDistance = measureDistance();
  calibrationFactor = referenceDistance / measuredDistance;
  Serial.print("Kalibracijski faktor: ");
  Serial.println(calibrationFactor);
}

void loop() {
  if (Serial.available()) {
    calibrate();
  }
  float distance = measureDistance() * calibrationFactor;
  lcd.setCursor(0, 0);
  lcd.print("Distance: ");
  lcd.print(distance);
  lcd.print(" cm  ");
  delay(100);
}


Testiranje po kalibraciji:
Ponovite meritve na različnih razdaljah (npr. 30 cm, 150 cm, 300 cm) in preverite, ali so odstopanja zmanjšana na ±3–5 mm.
Če odstopanja ostanejo velika, preverite strojno namestitev senzorja (npr. poravnava, motnje) ali ponovite kalibracijo z več referenčnimi točkami.
Periodična kalibracija:
Kalibracijo ponavljajte ob spremembah temperature ali po daljši uporabi, saj se zmogljivost HC-SR04 lahko s časom poslabša.
Če dodate temperaturni senzor, avtomatizirajte prilagoditev hitrosti zvoka, kar zmanjša potrebo po pogosti ročni kalibraciji.

Zaključek
Merilna naprava razdalje je funkcionalna za osnovne aplikacije, dosega natančnost ±5–10 mm v idealnih pogojih, kar je slabše od referenčnega merilnega traku (±1 mm). Glavne omejitve so pomanjkanje temperaturne kompenzacije, povprečenja meritev in filtriranja šuma. Z dodanim temperaturnim senzorjem, povprečenjem, median filtriranjem in kalibracijskim načinom lahko natančnost izboljšamo na ±3–5 mm. Predlagane izboljšave vključujejo tudi optimizacijo LCD izpisa in morebitno nadgradnjo na laserski senzor (npr. VL53L0X) za aplikacije, ki zahtevajo večjo natančnost. Postopek kalibracije, opisan zgoraj, je prilagojen napravi in omogoča zmanjšanje sistematičnih napak z uporabo referenčnega merilnega traku. 

Izračunov komponent vezja nimava, saj ni  jih nisva potrebovala.
